//
//Generated by AdminBooster
//

public class submitBarclaysv3{
	public String externalApplicationReference;	//03ZNN5240
	public string returnURL;
	public cls_illustrationRequest illustrationRequest;
	public cls_applicantRequest applicantRequest;
	class cls_illustrationRequest {
		public cls_assets[] assets;
		public cls_finance finance;
	}
	class cls_assets {
		public decimal cost;	//2140
		public String description;	//BOILER
		public String assetType;	//CH1
	}
	class cls_finance {
		public decimal advance;	//2000
		public decimal deposit;	//200
		public Integer term;	//24
		public cls_interest interest;
		public String productCode;	//FTSTDI
		public String sellingType;	//ONTRADE
		public String repaymentMethod;	//DIRECTDEBIT
		public decimal deferralPeriod;	//0
	}
	class cls_interest {
		public String interestType;	//APR
		public decimal interestRate;	//0
	}
	class cls_applicantRequest {
		public String title;	//MR
		public String firstName;	//Steve
		public String middleName;	//
		public String lastName;	//Bibby
		public date dateOfBirth;	//1959-11-04
		public String gender;	//MALE
		public String maritalStatus;	//SINGLE
		public decimal numberOfDependents;	//0
		public String nationality;	//GB
		public cls_identityProof identityProof;
		public cls_addressProof addressProof;
		public cls_contactDetails contactDetails;
		public cls_addressHistory[] addressHistory;
		public cls_shippingAddress shippingAddress;
		public cls_bankAccount bankAccount;
		public cls_employmentDetails employmentDetails;
		public cls_incomeDetails incomeDetails;
		public cls_outgoings outgoings;
	}
	class cls_identityProof {
		public String type;	//ENHANCED_DEBIT_OR_CREDIT_CARD
		public String value;	//1828 11/2021
	}
	class cls_addressProof {
		public String type;	//NOT_REQUIRED
		public String value;	//N/A
	}
	class cls_contactDetails {
		public String mobileNumber;	//07702694362
		public String homeNumber;	//01430871810
		public String emailAddress;	//SALES@ELITEKITCHENSANDBEDROOMS.CO.UK
	}
	class cls_addressHistory {
		public date fromDate;	//2016-04-24T12:21:48.156Z
		public date toDate;
		public String type;	//OWNER_OCCUPIER
		public cls_address address;
	}
	class cls_address {
		public String buildingNumber;	//99
		public String buildingName;	//
		public String flatNumber;	//
		public String street;	//WICSTUN WAY
		public String town;	//MARKET WEIGHTON
		public String county;	//NORTH YORKSHIRE
		public String postcode;	//YO43 3FA
		public String country;	//GB
	}
	class cls_shippingAddress {
		public String buildingNumber;	//
		public String buildingName;	//FLORENT COURT
		public String flatNumber;	//1
		public String street;	//REGENT STREET
		public String town;	//POCKLINGTON
		public String county;	//NORTH YORKSHIRE
		public String postcode;	//YO42 2PQ
		public String country;	//GB
	}
	class cls_bankAccount {
		public String accountHolderName;	//MR S BIBBY
		public String accountNumber;	//82000859
		public String sortCode;	//601635
		public datetime openDate;	//1978-10-24T12:21:48.825Z
	}
	class cls_employmentDetails {
		public String occupationType;	//EMPLOYED
		public String employerName;	//ELITE KITCHEN & BEDR
		public String jobTitle;	//DIRECTOR
	}
	class cls_incomeDetails {
		public decimal grossAnnualIncome;	//35000
		public decimal grossAnnualDisabilityAllowance;
		public decimal grossAnnualMobility;
		public decimal grossAnnualIncapacity;
		public decimal grossAnnualAdditionalBenefits;
		public decimal grossAnnualStatePension;
		public decimal grossAnnualOtherPension;
		public decimal otherIncome;
		public string  otherIncomeDescription; 
	}
	class cls_outgoings {
	    public decimal monthlyRent;
	    //public decimal monthlyMortgage;
	    public decimal monthlyDependentsCareCosts;
	}
	
	class cls_changeInFutureCircumstances {
	    public decimal expectedMonthlyExpenditureIncrease;
	    public decimal expectedDecreasedAnnualIncome;
	}
	
	public submitBarclaysv3(Finance_Application__c fa )
	{
	    this.externalApplicationReference = fa.Application_ID__c;
	    if(userinfo.getusername().contains('portal'))
	    this.returnURL = fa.Portal_Link__c;
	    //barclaysIntegrationHelper helperObj = new barclaysIntegrationHelper();
	    map<string, map<string, string>> barcalysFieldMapping = new map<string, map<string, string>>();
	    
	    
	    
	    for(Finance_Data_Mappings__c f: Finance_Data_Mappings__c.getAll().values())
        {
            if(f.Barclays_2019__c!=null)
            {
                if(barcalysFieldMapping.containskey(f.Field__c))
                {
                    barcalysFieldMapping.get(f.Field__c).put(f.PicklistOption__c,f.Barclays_2019__c);
                }else
                {
                    map<string, string> mapList = new map<string, string>{f.PicklistOption__c => f.Barclays_2019__c};
                    
                    barcalysFieldMapping.put(f.Field__c, mapList );
                }
            }
        }
	    system.debug(barcalysFieldMapping);
	    this.externalApplicationReference = fa.Lead_Ext_Ref_No__c;
	    
	    // client proof
	    cls_identityProof clientObj = new cls_identityProof();
	    
	    clientObj.type = barcalysFieldMapping.get('TypeOfProof (Signature)').get(fa.Signature_Proof_of_Id__c);
	    clientObj.value = fa.Sign_Proof_Details__c;
	    
	    
	    // address proof - Confirmed by Team Oscar team & Rhys from Barcalys
	    cls_addressProof addObj = new cls_addressProof();
	    addObj.type = 'NOT_REQUIRED';
	    addObj.value = 'N/A';
	    
	    // contact details
	    cls_contactDetails contObj = new cls_contactDetails();
	    contObj.emailAddress = fa.Email__c;
	    contObj.mobileNumber = fa.Mobile__c;
	    contObj.homeNumber = fa.Home_Phone__c;
	    
	    
	    
	    
	    //
	    
	    // applicationRequest
	    cls_applicantRequest appObj = new cls_applicantRequest();
	    appObj.title = barcalysFieldMapping.get('Title').get(fa.Title__c);
	    appObj.firstName = fa.First_Name__c;
	    appObj.middleName = fa.Middle_Name__c!=null?fa.Middle_Name__c:'';
	    appObj.lastName = fa.Last_Name__c;
	    appObj.dateOfBirth = fa.Date_Of_Birth__c;
	    appObj.gender =  barcalysFieldMapping.get('Gender').get(fa.Gender__c);
		appObj.maritalStatus = barcalysFieldMapping.get('MaritalStatus').get(fa.Marital_Status__c);
		appObj.numberOfDependents = fa.Number_Of_Dependents__c;
		appObj.nationality = barcalysFieldMapping.get('Country').get(fa.Nationality__c);
		appObj.addressProof = addObj;
		appObj.identityProof = clientObj;
		
		//Present address
		appObj.shippingAddress = new cls_shippingAddress();
		cls_address tempObj = createBFCustomerAddress(fa.Building_Number1__c, fa.Building_Name1__c, fa.Street1__c, fa.City1__c, fa.State1__c, fa.Post_Code1__c );
		appObj.shippingAddress.buildingNumber = tempObj.buildingNumber;
        appObj.shippingAddress.buildingName = tempObj.buildingName;
        appObj.shippingAddress.street = tempObj.street;
        appObj.shippingAddress.town = tempObj.town;
        appObj.shippingAddress.county = tempObj.county;
        appObj.shippingAddress.postcode = tempObj.postcode;
        appObj.shippingAddress.country =  barcalysFieldMapping.get('Country').get(fa.Country1__c);
		
		appObj.addressHistory = new list<cls_addressHistory>();
		
		// Address history 
	    if(fa.Post_Code1__c!=null)
        {
           
           cls_addressHistory customerAddress1  = new cls_addressHistory();
           customerAddress1.type = 	barcalysFieldMapping.get('ResidentialStatus').get(fa.Occupancy_Status1__c); // Previous Address P
           customerAddress1.fromDate = fa.Add1_Date__c;
           customerAddress1.address = createBFCustomerAddress(fa.Building_Number1__c, fa.Building_Name1__c, fa.Street1__c, fa.City1__c, fa.State1__c, fa.Post_Code1__c );
           customerAddress1 = customerAddress1;
           appObj.addressHistory.add(customerAddress1);
        }
		
		// Address history 
	    if(fa.Post_Code2__c!=null)
        {
           
           cls_addressHistory customerAddress2  = new cls_addressHistory();
           customerAddress2.type = 	barcalysFieldMapping.get('ResidentialStatus').get(fa.Occupancy_Status2__c); // Previous Address P
           customerAddress2.fromDate = fa.Add2_Date__c;
           customerAddress2.toDate = fa.Add1_Date__c;
           customerAddress2.address = createBFCustomerAddress(fa.Building_Number2__c, fa.Building_Name2__c, fa.Street2__c, fa.City2__c, fa.State2__c, fa.Post_Code2__c );
           customerAddress2 = customerAddress2;
           appObj.addressHistory.add(customerAddress2);
        }
        if(fa.Post_Code3__c!=null)
        {
           //appObj.addressHistory = new list<cls_addressHistory>();
           cls_addressHistory customerAddress3  = new cls_addressHistory();
           customerAddress3.type = 		barcalysFieldMapping.get('ResidentialStatus').get(fa.Occupancy_Status3__c); // Previous Address P
           customerAddress3.fromDate = fa.Add3_Date__c;
           customerAddress3.toDate = fa.Add2_Date__c;
           customerAddress3.address = createBFCustomerAddress(fa.Building_Number3__c, fa.Building_Name3__c, fa.Street3__c, fa.City3__c, fa.State3__c, fa.Post_Code3__c );
           customerAddress3 = customerAddress3;
           appObj.addressHistory.add(customerAddress3);
        }
        
	    
	    
	    // Assets 
	    cls_assets clsObj = new cls_assets();
	    clsObj.cost = fa.Job_Total__c;
    	clsObj.description = fa.Finance_Product__r.Asset_Type_Description__c;
	    clsObj.assetType = fa.Finance_Product__r.Asset_Type__c;
	    
	    appObj.contactDetails=contObj;
	    // Interest
	    cls_interest intObj = new cls_interest();
	    intObj.interestType = 'APR';
	    intObj.interestRate = fa.Interest_Rate__c;
	    
	    // Finance 
	    cls_finance finObj = new cls_finance();
	    finObj.advance = fa.Cash_Price__c;
	    finObj.deposit = fa.Deposit__c;
	    finObj.term = integer.valueof(fa.Payment_Options__c.split('-')[0].trim());
	    finObj.productCode = fa.Finance_Product__r.Product_Code__c;
	    finObj.sellingType = fa.Finance_Product__r.Selling_Type__c;
	    finObj.repaymentMethod = 'DIRECTDEBIT';
	    finObj.deferralPeriod = fa.Finance_Product__r.deferral_Period__c;
	    finObj.interest = intObj;
	    
	    cls_bankAccount bankdetials = new cls_bankAccount();
	    bankdetials.accountHolderName = fa.Bank_Account_Name__c;
	    bankdetials.accountNumber = fa.Bank_Account_Number__c;
	    bankdetials.sortCode = fa.Sort_Code__c;
	    bankdetials.openDate = fa.Date_Opened__c;
	    appObj.bankAccount = bankdetials;
	    cls_employmentDetails 	empClass = new 	 cls_employmentDetails();
    	empClass.occupationType = barcalysFieldMapping.get('EmploymentStatus').get(fa.Employment_Status__c); // Previous Address P
	    
	    if(fa.Employment_Status__c != 'Retired' && fa.Employment_Status__c != 'Benefits')
	    {
    	   	//EMPLOYED
    		empClass.employerName = fa.Employer_Name__c;	//ELITE KITCHEN & BEDR
    		empClass.jobTitle = fa.Job_Description__c;	//DIRECTOR
    		
	    }
	    appObj.employmentDetails = empClass;
	    cls_incomeDetails  incomeObj = new cls_incomeDetails();
		incomeObj.grossAnnualIncome = fa.Gross_Income__c;	//35000
	    appObj.incomeDetails = incomeObj;
	    
	    if(fa.Rent__c != null || fa.Monthly_Expense__c!=null)
	    {
    	    cls_outgoings outgoingObj = new cls_outgoings();
    	    outgoingObj.monthlyRent =   fa.Rent__c;
    	    outgoingObj.monthlyDependentsCareCosts = fa.Monthly_Expense__c;
    	    appObj.outgoings = outgoingObj;
	    }
	    
	    if(fa.Expense_Variation_Value__c !=null || fa.Income_Variation_value__c!=null)
	    {
	        cls_changeInFutureCircumstances changeObj= new cls_changeInFutureCircumstances();
	        changeObj.expectedMonthlyExpenditureIncrease = fa.Expense_Variation_Value__c;
	        changeObj.expectedDecreasedAnnualIncome = fa.Income_Variation_value__c;
	    }
	    
	    
	    
        this.illustrationRequest = new cls_illustrationRequest();
	    this.illustrationRequest.assets =  new list<cls_assets>{clsObj};
	    this.illustrationRequest.finance = finObj;
	    this.applicantRequest = appObj;
	}
	
	public static submitBarclaysv3 parse(String json){
		return (submitBarclaysv3) System.JSON.deserialize(json, submitBarclaysv3.class);
	}
	
	/*
    static testMethod void testParse() {
		String json=		'{'+
		'  "externalApplicationReference": "03ZNN5240",'+
		'  "illustrationRequest": {'+
		'    "assets": ['+
		'      {'+
		'        "cost": 2140,'+
		'        "description": "BOILER",'+
		'        "assetType": "CH1"'+
		'      },'+
		'      {'+
		'        "cost": 60,'+
		'        "description": "INSTALLATION",'+
		'        "assetType": "CH1"'+
		'      }'+
		'    ],'+
		'    "finance": {'+
		'      "advance": 2000.00,'+
		'      "deposit": 200.00,'+
		'      "term": 24,'+
		'      "interest": {'+
		'        "interestType": "APR",'+
		'        "interestRate": 0.00'+
		'      },'+
		'      "productCode": "FTSTDI",'+
		'      "sellingType": "ONTRADE",'+
		'      "repaymentMethod": "DIRECTDEBIT",'+
		'      "deferralPeriod": 0'+
		'    }'+
		'  },'+
		'  "applicantRequest": {'+
		'    "title": "MR",'+
		'    "firstName": "Steve",'+
		'    "middleName": "",'+
		'    "lastName": "Bibby",'+
		'    "dateOfBirth": "1959-11-04",'+
		'    "gender": "MALE",'+
		'    "maritalStatus": "SINGLE",'+
		'    "numberOfDependents": 0,'+
		'    "nationality": "GB",'+
		'    "identityProof": {'+
		'      "type": "ENHANCED_DEBIT_OR_CREDIT_CARD",'+
		'      "value": "1828 11/2021"'+
		'    },'+
		'    "addressProof": {'+
		'      "type": "NOT_REQUIRED",'+
		'      "value": "N/A"'+
		'    },'+
		'    "contactDetails": {'+
		'      "mobileNumber": "07702694362",'+
		'      "homeNumber": "01430871810",'+
		'      "emailAddress": "SALES@ELITEKITCHENSANDBEDROOMS.CO.UK"'+
		'    },'+
		'    "addressHistory": ['+
		'      {'+
		'        "fromDate": "2016-04-24T12:21:48.156Z",'+
		'        "type": "OWNER_OCCUPIER",'+
		'        "address": {'+
		'          "buildingNumber": "99",'+
		'          "buildingName": "",'+
		'          "flatNumber": "",'+
		'          "street": "WICSTUN WAY",'+
		'          "town": "MARKET WEIGHTON",'+
		'          "county": "NORTH YORKSHIRE",'+
		'          "postcode": "YO43 3FA",'+
		'          "country": "GB"'+
		'        }'+
		'      },'+
		'      {'+
		'        "fromDate": "2007-04-25T12:21:48.157Z",'+
		'        "toDate": "2016-04-24T12:21:48.156Z",'+
		'        "type": "OWNER_OCCUPIER",'+
		'        "address": {'+
		'          "buildingNumber": "38",'+
		'          "buildingName": "",'+
		'          "flatNumber": "",'+
		'          "street": "ST HELENS ROAD",'+
		'          "town": "POCKLINGTON",'+
		'          "county": "NORTH YORKSHIRE",'+
		'          "postcode": "YO42 2NA",'+
		'          "country": "GB"'+
		'        }'+
		'      }'+
		'    ],'+
		'    "shippingAddress": {'+
		'      "buildingNumber": "",'+
		'      "buildingName": "FLORENT COURT",'+
		'      "flatNumber": "1",'+
		'      "street": "REGENT STREET",'+
		'      "town": "POCKLINGTON",'+
		'      "county": "NORTH YORKSHIRE",'+
		'      "postcode": "YO42 2PQ",'+
		'      "country": "GB"'+
		'    },'+
		'    "bankAccount": {'+
		'      "accountHolderName": "MR S BIBBY",'+
		'      "accountNumber": "82000859",'+
		'      "sortCode": "601635",'+
		'      "openDate": "1978-10-24T12:21:48.825Z"'+
		'    },'+
		'    "employmentDetails": {'+
		'      "occupationType": "EMPLOYED",'+
		'      "employerName": "ELITE KITCHEN & BEDR",'+
		'      "jobTitle": "DIRECTOR"'+
		'    },'+
		'   "incomeDetails": {'+
		'        "grossAnnualIncome": 35000'+
		'    },'+
		'    "outgoings": {'+
		'    }'+
		'  }'+
		'}';
		submitBarclaysv3 obj = parse(json);
		System.assert(obj != null);
	}
	*/
	
	public static cls_address  createBFCustomerAddress(string houseNo, string houseName, string street, string posttown , string county,  string postcode)
    {
        cls_address addressObj = new cls_address();
        string hnumber = houseNo != null ? houseNo:'';// : (houseName!=null? houseName : '');
        addressObj.buildingNumber = hnumber;
        addressObj.buildingName = houseName!=null? houseName : '';
        addressObj.street = street;
        addressObj.town = posttown;
        addressObj.county = county;
        addressObj.postcode = postcode;
        addressObj.country = 'GB';
        return addressObj;
	}
    
}